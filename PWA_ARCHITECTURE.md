# PWA Architecture Overview

## System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Browser                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              Main Application Thread                      â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚  â”‚
â”‚  â”‚  â”‚ Next.js App (src/app/layout.tsx)                â”‚     â”‚  â”‚
â”‚  â”‚  â”‚  - Loads manifest.json                          â”‚     â”‚  â”‚
â”‚  â”‚  â”‚  - Sets PWA meta tags                           â”‚     â”‚  â”‚
â”‚  â”‚  â”‚  - Includes service worker registration code   â”‚     â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚  â”‚
â”‚  â”‚                          â”‚                                â”‚  â”‚
â”‚  â”‚                          â”‚ Auto-registers                â”‚  â”‚
â”‚  â”‚                          â–¼                                â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚  â”‚
â”‚  â”‚  â”‚ window.workbox.register()                       â”‚     â”‚  â”‚
â”‚  â”‚  â”‚  - Runs on app load                             â”‚     â”‚  â”‚
â”‚  â”‚  â”‚  - Registers /sw.js                             â”‚     â”‚  â”‚
â”‚  â”‚  â”‚  - Scope: / (entire app)                        â”‚     â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                          â”‚                                       â”‚
â”‚                          â”‚ Registers                             â”‚
â”‚                          â–¼                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              Service Worker Thread                        â”‚  â”‚
â”‚  â”‚              (public/sw.js)                               â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚  â”‚
â”‚  â”‚  â”‚ Workbox Runtime                                 â”‚     â”‚  â”‚
â”‚  â”‚  â”‚  - precacheAndRoute()                           â”‚     â”‚  â”‚
â”‚  â”‚  â”‚  - registerRoute()                              â”‚     â”‚  â”‚
â”‚  â”‚  â”‚  - Cache strategies                             â”‚     â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚  â”‚
â”‚  â”‚                          â”‚                                â”‚  â”‚
â”‚  â”‚                          â–¼                                â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚  â”‚
â”‚  â”‚  â”‚ Cache Management                                â”‚     â”‚  â”‚
â”‚  â”‚  â”‚  - start-url (homepage)                         â”‚     â”‚  â”‚
â”‚  â”‚  â”‚  - pages (navigated pages)                      â”‚     â”‚  â”‚
â”‚  â”‚  â”‚  - static-js-assets (JS bundles)                â”‚     â”‚  â”‚
â”‚  â”‚  â”‚  - static-style-assets (CSS)                    â”‚     â”‚  â”‚
â”‚  â”‚  â”‚  - static-image-assets (images)                 â”‚     â”‚  â”‚
â”‚  â”‚  â”‚  - apis (API routes)                            â”‚     â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                          â”‚                                       â”‚
â”‚                          â”‚ Intercepts                            â”‚
â”‚                          â–¼                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                Network Requests                           â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚   fetch() â”€â”€â†’ Service Worker â”€â”€â†’ Cache or Network       â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Build Process

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Build Time (npm run build)                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                            â”‚
â”‚  â”‚  next.config.ts  â”‚                                            â”‚
â”‚  â”‚  withPWA({...})  â”‚                                            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                            â”‚
â”‚           â”‚                                                       â”‚
â”‚           â”‚ Configures                                           â”‚
â”‚           â–¼                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚      @ducanh2912/next-pwa Plugin              â”‚               â”‚
â”‚  â”‚                                                â”‚               â”‚
â”‚  â”‚  1. Analyzes Next.js build output             â”‚               â”‚
â”‚  â”‚  2. Generates precache manifest               â”‚               â”‚
â”‚  â”‚  3. Creates service worker                    â”‚               â”‚
â”‚  â”‚  4. Injects registration code                 â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚           â”‚                                                       â”‚
â”‚           â”‚ Generates                                            â”‚
â”‚           â–¼                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚         Generated Files                       â”‚               â”‚
â”‚  â”‚                                                â”‚               â”‚
â”‚  â”‚  ğŸ“„ public/sw.js                              â”‚               â”‚
â”‚  â”‚     - Main service worker                     â”‚               â”‚
â”‚  â”‚     - Precache routes                         â”‚               â”‚
â”‚  â”‚     - Runtime caching strategies              â”‚               â”‚
â”‚  â”‚                                                â”‚               â”‚
â”‚  â”‚  ğŸ“„ public/workbox-*.js                       â”‚               â”‚
â”‚  â”‚     - Workbox runtime library                 â”‚               â”‚
â”‚  â”‚                                                â”‚               â”‚
â”‚  â”‚  ğŸ“„ public/swe-worker-*.js                    â”‚               â”‚
â”‚  â”‚     - Service worker entry helper             â”‚               â”‚
â”‚  â”‚                                                â”‚               â”‚
â”‚  â”‚  ğŸ“¦ .next/static/chunks/39-*.js               â”‚               â”‚
â”‚  â”‚     - Contains registration code              â”‚               â”‚
â”‚  â”‚     - window.workbox.register()               â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Caching Strategy Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Request Handling                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  User Action (Navigate, Fetch)                                  â”‚
â”‚           â”‚                                                       â”‚
â”‚           â–¼                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                        â”‚
â”‚  â”‚  Service Worker      â”‚                                        â”‚
â”‚  â”‚  Intercepts Request  â”‚                                        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                        â”‚
â”‚             â”‚                                                     â”‚
â”‚             â–¼                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚        Route Matching                        â”‚                â”‚
â”‚  â”‚                                               â”‚                â”‚
â”‚  â”‚  Is it a page request?                       â”‚                â”‚
â”‚  â”‚    â”œâ”€ Yes â†’ NetworkFirst strategy            â”‚                â”‚
â”‚  â”‚    â”‚         (Try network, fallback cache)   â”‚                â”‚
â”‚  â”‚    â”‚                                          â”‚                â”‚
â”‚  â”‚  Is it a static asset?                       â”‚                â”‚
â”‚  â”‚    â”œâ”€ Yes â†’ CacheFirst strategy              â”‚                â”‚
â”‚  â”‚    â”‚         (Try cache first, then network) â”‚                â”‚
â”‚  â”‚    â”‚                                          â”‚                â”‚
â”‚  â”‚  Is it an API request?                       â”‚                â”‚
â”‚  â”‚    â””â”€ Yes â†’ NetworkFirst with timeout        â”‚                â”‚
â”‚  â”‚              (Network priority, cache backup)â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚             â”‚                                                     â”‚
â”‚             â–¼                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚         Cache Operations                     â”‚                â”‚
â”‚  â”‚                                               â”‚                â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚                â”‚
â”‚  â”‚  â”‚  Cache Storage                      â”‚     â”‚                â”‚
â”‚  â”‚  â”‚                                      â”‚     â”‚                â”‚
â”‚  â”‚  â”‚  â€¢ start-url                        â”‚     â”‚                â”‚
â”‚  â”‚  â”‚    - Homepage                       â”‚     â”‚                â”‚
â”‚  â”‚  â”‚    - Fresh on page load             â”‚     â”‚                â”‚
â”‚  â”‚  â”‚                                      â”‚     â”‚                â”‚
â”‚  â”‚  â”‚  â€¢ pages                            â”‚     â”‚                â”‚
â”‚  â”‚  â”‚    - Visited pages                  â”‚     â”‚                â”‚
â”‚  â”‚  â”‚    - NetworkFirst strategy          â”‚     â”‚                â”‚
â”‚  â”‚  â”‚    - 32 entries max                 â”‚     â”‚                â”‚
â”‚  â”‚  â”‚    - 24h expiration                 â”‚     â”‚                â”‚
â”‚  â”‚  â”‚                                      â”‚     â”‚                â”‚
â”‚  â”‚  â”‚  â€¢ next-static-js-assets            â”‚     â”‚                â”‚
â”‚  â”‚  â”‚    - JavaScript bundles             â”‚     â”‚                â”‚
â”‚  â”‚  â”‚    - CacheFirst strategy            â”‚     â”‚                â”‚
â”‚  â”‚  â”‚    - 64 entries max                 â”‚     â”‚                â”‚
â”‚  â”‚  â”‚    - 24h expiration                 â”‚     â”‚                â”‚
â”‚  â”‚  â”‚                                      â”‚     â”‚                â”‚
â”‚  â”‚  â”‚  â€¢ static-style-assets              â”‚     â”‚                â”‚
â”‚  â”‚  â”‚    - CSS files                      â”‚     â”‚                â”‚
â”‚  â”‚  â”‚    - StaleWhileRevalidate           â”‚     â”‚                â”‚
â”‚  â”‚  â”‚    - 32 entries max                 â”‚     â”‚                â”‚
â”‚  â”‚  â”‚    - 24h expiration                 â”‚     â”‚                â”‚
â”‚  â”‚  â”‚                                      â”‚     â”‚                â”‚
â”‚  â”‚  â”‚  â€¢ static-image-assets              â”‚     â”‚                â”‚
â”‚  â”‚  â”‚    - Images                         â”‚     â”‚                â”‚
â”‚  â”‚  â”‚    - StaleWhileRevalidate           â”‚     â”‚                â”‚
â”‚  â”‚  â”‚    - 64 entries max                 â”‚     â”‚                â”‚
â”‚  â”‚  â”‚    - 30 days expiration             â”‚     â”‚                â”‚
â”‚  â”‚  â”‚                                      â”‚     â”‚                â”‚
â”‚  â”‚  â”‚  â€¢ apis                             â”‚     â”‚                â”‚
â”‚  â”‚  â”‚    - API routes                     â”‚     â”‚                â”‚
â”‚  â”‚  â”‚    - NetworkFirst                   â”‚     â”‚                â”‚
â”‚  â”‚  â”‚    - 10s network timeout            â”‚     â”‚                â”‚
â”‚  â”‚  â”‚    - 16 entries max                 â”‚     â”‚                â”‚
â”‚  â”‚  â”‚    - 24h expiration                 â”‚     â”‚                â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚             â”‚                                                     â”‚
â”‚             â–¼                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚      Return Response to Browser             â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Configuration Files Relationship

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Configuration Flow                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚  tsconfig.json   â”‚        â”‚  next.config.ts  â”‚             â”‚
â”‚  â”‚                  â”‚        â”‚                  â”‚             â”‚
â”‚  â”‚  Provides types: â”‚        â”‚  PWA Config:     â”‚             â”‚
â”‚  â”‚  - workbox API   â”‚        â”‚  - register:true â”‚             â”‚
â”‚  â”‚  - window.workboxâ”‚        â”‚  - dest:public   â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚  - caching opts  â”‚             â”‚
â”‚           â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚           â”‚                           â”‚                        â”‚
â”‚           â”‚                           â”‚                        â”‚
â”‚           â–¼                           â–¼                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚          Next.js App Build                 â”‚               â”‚
â”‚  â”‚                                              â”‚               â”‚
â”‚  â”‚  Uses types â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚               â”‚
â”‚  â”‚                        â”‚                    â”‚               â”‚
â”‚  â”‚  Generates SW â†â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚           â”‚                                                     â”‚
â”‚           â–¼                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚  manifest.json   â”‚        â”‚  src/app/        â”‚             â”‚
â”‚  â”‚                  â”‚        â”‚  layout.tsx      â”‚             â”‚
â”‚  â”‚  PWA Metadata:   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”‚                  â”‚             â”‚
â”‚  â”‚  - name          â”‚ Linked â”‚  Meta tags:      â”‚             â”‚
â”‚  â”‚  - icons         â”‚   by   â”‚  - manifest link â”‚             â”‚
â”‚  â”‚  - theme color   â”‚        â”‚  - apple icons   â”‚             â”‚
â”‚  â”‚  - display mode  â”‚        â”‚  - theme color   â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## File Dependencies

```
Repository Root
â”œâ”€â”€ next.config.ts â”€â”€â”€â”€â”€â”€â”€â”€â”€â” (PWA build config)
â”œâ”€â”€ tsconfig.json â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ (TypeScript types)
â”‚                            â”‚
â”œâ”€â”€ package.json â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ (Dependencies)
â”‚   â””â”€â”€ @ducanh2912/next-pwaâ”‚
â”‚                            â”‚
â”œâ”€â”€ public/                 â”‚
â”‚   â”œâ”€â”€ manifest.json â”€â”€â”€â”€â”€â”€â”¤ (PWA manifest)
â”‚   â”œâ”€â”€ icons/ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ (PWA icons)
â”‚   â”‚   â”œâ”€â”€ icon-72x72.png  â”‚
â”‚   â”‚   â”œâ”€â”€ icon-192x192.pngâ”‚
â”‚   â”‚   â””â”€â”€ icon-512x512.pngâ”‚
â”‚   â”‚                        â”‚
â”‚   â””â”€â”€ [Generated at build]â”‚
â”‚       â”œâ”€â”€ sw.js â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ (Service worker)
â”‚       â”œâ”€â”€ workbox-*.js â”€â”€â”€â”€â”¤ (Workbox runtime)
â”‚       â””â”€â”€ swe-worker-*.js â”€â”¤ (SW helper)
â”‚                            â”‚
â”œâ”€â”€ src/app/                â”‚
â”‚   â””â”€â”€ layout.tsx â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ (PWA meta tags)
â”‚
â””â”€â”€ .next/ [Build output]
    â””â”€â”€ static/chunks/
        â””â”€â”€ 39-*.js (Registration code)
```

## Key Insights

### Why TypeScript Types Matter
```typescript
// Without types in tsconfig.json
window.workbox // âŒ TypeScript error: Property 'workbox' does not exist

// With types configured
window.workbox // âœ… Recognized as Workbox instance
window.workbox.register() // âœ… Full IntelliSense support
```

### Registration Flow
```
1. Build Time:
   - Plugin analyzes app
   - Generates sw.js with precache manifest
   - Injects registration code into app bundle

2. Page Load (Production):
   - App loads
   - Chunk with registration code executes
   - window.workbox.register() called
   - Browser registers /sw.js
   - Service worker activates

3. Subsequent Visits:
   - Service worker intercepts requests
   - Applies caching strategies
   - Serves cached content when offline
   - Updates cache in background
```

### Development vs Production

```
Development (npm run dev):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PWA: DISABLED              â”‚
â”‚  Service Worker: Not loaded â”‚
â”‚  Caching: None              â”‚
â”‚  Purpose: Easy debugging    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Production (npm run build + start):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PWA: ENABLED               â”‚
â”‚  Service Worker: Active     â”‚
â”‚  Caching: Full              â”‚
â”‚  Purpose: App performance   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```
